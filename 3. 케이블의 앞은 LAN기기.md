# 3. 케이블의 앞은 LAN기기

1. 케이블과 리피터, 허브 속을 신호가 흘러감

   컴퓨터에서 나온 신호는 케이블을 통해 리피터 허브 등을 경유하여 진행함. 신호가 흐르는 도중에 약해지거나 변형되는것을 억제하기 위함

2. 스위칭 허브의 패킷 중계 동작

   스위칭 허브는 신호를 흘리지 않고 패킷의 신호를 수신하여 디지털 데이터의 형태로 되돌려주고, 다시 신호로 고쳐서 송신하는 동작을 통해 패킷을 운반

3. 라우터의 패킷 중계 동작

   스위칭 허브와 마찬가지로 패킷을 중계하지만 스위칭 허브는 이더넷 구조 기반, 라우터는 IP 구조 기반

4. 라우터의 부가 기능

   인터넷의 출입구에 배치하는 라우터는 일반적으로 private 주소를 글로벌 주소로 변환하는 주소 변환 기능과 위험한 패킷을 차단하는 패킷 필터링 기능을 이용함



## 케이블과 리피터, 허브 속을 신호가 흘러감

### 하나하나의 패킷이 독립된 것으로 동작

- 컴퓨터에서 송신된 패킷은 허브나 라우터라는 중계 장치에 의해 중계되어 목적지를 향해 진행함
- 중계동작은 데이터 부분을 보지 않고 패킷을 중계
- 클라이언트가 리피터허브-스위칭허브-라우터를 경유하여 인터넷에 나가는 것으로 간주하고 설명

### LAN 케이블은 신호를 약화시키지 않는 것이 핵심

- NIC의 PHY(MAU) 회로에서 전기 신호로 형태를 바꾼 패킷은 RJ-45 커넥터를 통해 트위스트 페어 케이블에 들어감
- 이더넷의 신호의 실체는 플러스와 마이너스의 전압이므로 신호가 2개 1조로 꼬여있음
- 송출한 신호는 그대로의 모습으로 허브에 도착하는 것이 아니라 허브에 도착할 때는 신호가 약해짐. -> 케이블을 통과하는 사이에 신호의 에너지가 조금씩 떨어지므로 케이블의 길이가 길어질수록 신호가 약해짐
- 이더넷은 사각형의 각진 신호를 사용하지만 전송하는 과정에서 각이 뭉개져서 둥글게 됨
- 신호의 각진 부분은 전압이 급격히 변화하는데, 이는 해당 부분의 주파수가 높다는 것 -> 높은 신호는 약해지므로 급격한 변화가 없어져서 각이 뭉개짐
- 잡음이 없고 조건이 좋은 경우에도 신호가 도착할 때는 이와 같이 변형되는데, 이것에 잡음의 영향까지 더해지면 매우 심각하게 변형됨 -> 통신 오류의 원인이 됨

### '꼼'은 잡음을 방지하기 위한 방법

- LAN 케이블로 사용하는 트위스트 페어 케이블에는 잡음의 영향을 억제하는 대책이 마련되어 있는데 이것이 '꼼'
- 잡음의 원인 - 케이블의 주위에서 발생하는 전자파
- 전자파가 금속 등의 도전체에 닿으면 그 안에 전류가 그 안에 전류가 발생한다는 성질이 있음
- 이 때문에 케이블의 주위에 전자파가 있으면 신호와는 다른 전류가 케이블 안에 흐름
- 신호도 전류이므로 잡음에 의해 생기는 전류와 다르지 않음. 따라서 신호와 잡음의 전류가 뒤섞여서 신호의 파형이 변형됨
- 케이블이 영향을 받는 전자파는 두 종류로 나뉨
  - 모니터, 형광등, CRT모니터와 같은 기기에서 누설되는 전자파 -> 케이블의 밖에서 오는 것으로, 선을 꼼으로써 막을 수 있음
  - 같은 케이블 안의 인접한 신호선에서 누설되는 전자파 -> 신호선 안에는 신호라는 전류가 흐르므로 전류에 의해 주위에 전자파가 생김. 이것이 다른 신호선에 대한 잡음이 되는데, 이러한 잡음에 의한 영향을 crosstalk라고 함
- 잡음은 원래 강한 것이 아니지만 거리가 가까운 곳이 문제임
- 전자파는 발생 근원에서 떨어지면 확산되어 약해지는데, 한 개의 케이블 안에 있는 신호선은 거리가 가까우므로 전자파가 약해지기 전에 인접 신호선에 도달해 버림. -> 신호선에서 나오는 약간의 전자파가 주위의 신호선에 닿아 여기에서 전류를 발생시키는 것
- 따라서 신호선을 마주 꼬면 잡음의 영향이 줄어들면서 케이블의 성능이 향상됨
- 이외에도 신호선 사이의 거리를 유지하기 위해 신호선 사이에 구분판을 넣거나 전자파를 차단하기 위해  금속성의 실드라는 피복을 입히는 등 여러 가지 대책이 마련되어 있음

### 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신함

- 신호가 리피터 허브에 도달하면 LAN 전체에 신호가 흩어짐
- 리피터 허브의 내부 구조
  - NIC 내부에 있는 PHY(MAU) 회로와 역할이 같은 회로가 있음
  - 이것을 NIC측과 같이 RJ-45 커넥터에 직접 접속하면 신호를 제대로 수신할 수 없음
  - 제대로 수신하려면 송신 단자에서 보낸 신호를 수신 단자로 받도록 해야 함
  - 허브 안의 PHY(MAU) 회로와 커넥터 사이의 신호선을 교차시켜서 접속하는 것은 이 때문
  - 리피터 허브에서 끝의 커넥터에는 MDI/MDI-X와 같이 쓰여있는 전환 스위치가 붙어있음
  - MDI - RJ-45 커넥터와 신호 송수신 회로를 직접 결선한 것
  - MDI-X - 교차하여 결선한 것
  - 허브의 커넥터 부분은 보통 MDI-X이므로 허브끼리 접속할 때는 한쪽을 MDI로 설정해야 함
  - MDI로 전환하는 스위치가 없고 모든 커넥터가 MDI-X인 경우에는 크로스 케이블로 허브들을 접속함
- 리피터 허브에서 PHY(MAU) 회로의 수신부에 도달한 신호는 여기부터 리피터 회로에 들어감
- 리피터 회로는 들어오는 신호를 그대로 커넥터 부분에 송출
- 신호는 모든 커넥터에서 나가면서 리피터 허브에 접속한 전체 기기에 도달함
- 신호를 수신한 기기는 맨 앞에 있는 MAC 헤더에 쓰여있는 수신처 MAC 주소를 조사하여 자신인지 아닌지 판단



## 스위칭 허브의 패킷 중계 동작

### 스위칭 허브는 주소 테이블로 중계

스위칭 허브는 이더넷의 패킷을 그대로 목적지를 향해 중계하도록 만들어짐

1. 신호가 커넥터 부분에 도달하여 PHY(MAU) 회로에서 수신되는 부분까지는 리피터 허브와 같음
2. 커넥터와 PHY(MAU) 회로는 MDI-X로 접속되어 있고, 트위스트 페어 케이블에서 신호가 들어오면 이것이 PHY(MAU) 회로의 수신 부분에 들어감
3. PHY(MAU) 회로에서 케이블을 흐르는 신호의 형식부터 공통의 신호 형식으로 변환한 후 신호는 MAC 회로로 들어감
4. 디지털 데이터로 변환한 후 패킷의 맨 끝에 있는 FCS를 대조하여 오류의 유무를 검사하고, 문제가 없으면 버퍼 메모리에 저장함(NIC와 거의 같으므로 각 스위칭 허버의 커넥터 안쪽에는 NIC와 같은 회로가 있다고 생각하면 됨 - 포트라 부름)
5. NIC에는 MAC주소가 할당되어 있지만, 스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장하기 때문에 스위칭 허브의 포트에는 NIC 어댑터와 달리 MAC 주소가 할당되어 있지 않음
6. 패킷을 버퍼 메모리에 저장하면 다음에 수신처 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는지 조사함
7. MAC 주소표에는 기기의 MAC 주소와 그 기기가 어느 포트에 존재하는지에 대한 정보가 등록되어 있음
8. 따라서 MAC 주소와 일치하는 포트에 패킷을 전송함

#### 스위치 회로의 구조

- 신호선이 격자모양으로 배치되고, 교점에 스위치가 있음
- 스위치를 전자적으로 개폐를 제어할 수 있고, 이 전자적 개폐를 통해 신호가 흐르는 대상을 제어함
- 입력측은 수신측 포트에, 출력측은 송신측 포트에 각각 접속되어 있음
- 이 스위치 회로를 경유하여 송신측의 포트에 패킷을 운반하면 MAC 회로나 PHY(MAU) 회로가 송신 동작을 실행하고 케이블에 신호가 흘러감
- 규칙에 따라 송수신 회로의 수신 부분에 신호가 흘러들어오는지 확인하거나 송신중인지 확인, 충돌에 따른 재밍 신호를 보내는 부분도 NIC와 같음

### MAC 주소 테이블을 등록 및 갱신

- 스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행함
  - 패킷을 수신했을 때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록하는 것 -> 패킷이 들어온 포트의 앞에 패킷을 송신한 기기가 있을 것이므로 송신처 주소를등록해 두면 MAC 주소로 갈 패킷을 수신했을 때 이것이 존재하는 포트에 중계할 수 있음
  - MAC 주소표에 등록되어 있는 내용을 지움 -> 기기를 이동한 경우의 불편함을 방지하기 위함

### 예외적인 동작

Ex) 주소표에서 일치하는 행을 찾아냈을 때 주소표에 등록되어 있는 송신 포트가 패킷을 수신한 포트와 같을 때 -> 스위칭 허브에 리피터 허브가 접속되어 있는 경우에 발생

1. PC A에서 보낸 패킷은 리피터 허브에 도착하고, 여기에서 모든 포트에 뿌려져서 스위칭 허브와 PC B에 도착함.
2. 이때 스위칭 허브가 패킷을 중계하면 같은 패킷을 리피터 허브에 반송
3. 그러면 리피터 허브에서 뿌려지고 PC A와 PC B에 패킷이 도착한 후 PC B에 두 개의 같은 패킷이 도착함
4. 이런 상태로는 통신 동작이 제대로 이루어지지 않으므로 스위칭 허브는 패킷을 수신한 포트와 송신하는 포트가 같은 경우 패킷을 중계하지 않고 폐기함